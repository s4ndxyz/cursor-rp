# cursor-rp

[简体中文](README.md) | [English](README.en.md) | [Français](README.fr.md) | [Español](README.es.md) | [العربية](README.ar.md)

## Введение
Локальный обратный прокси. Введение краткое, намеренно.

## Установка
1. Скачайте modifier и ccursor с https://github.com/wisdgod/cursor-rp/releases
2. Переименуйте их в стандартные имена и поместите в одну директорию

## Конфигурация и использование
Возьмем порт 3000 и .local в качестве примера:

### 1. Патч Cursor
1. Откройте Cursor, выполните команду `Open User Settings` и запомните путь к файлу настроек
2. Закройте Cursor, примените патч (требуется повторное выполнение после каждого обновления):
   ```bash
   /path/to/modifier --cursor-path /path/to/cursor --port 3000 --suffix .local local
   ```

**Особые примечания**:
- Пользователи Windows: Особого внимания не требуется
- Пользователи macOS: Требуется ручная подпись из-за SIP (аналогично Windows, если SIP отключен)
- Пользователи Linux: Необходимо обработать формат AppImage
- Справочные скрипты: [macos.sh](macos.sh) | [linux.sh](linux.sh) (PR приветствуются)

### 2. Настройка Hosts
При использовании параметра `--skip-hosts`, вручную добавьте эти записи в hosts:
```
127.0.0.1 api2.cursor.sh.local api3.cursor.sh.local repo42.cursor.sh.local api4.cursor.sh.local us-asia.gcpp.cursor.sh.local us-eu.gcpp.cursor.sh.local us-only.gcpp.cursor.sh.local
```

### 3. Запуск сервиса
```bash
/path/to/ccursor
```

## Детали конфигурации
В `config.toml` закомментируйте или удалите неизвестные параметры, **НЕ оставляйте их пустыми**.

При миграции с версии 0.1.x, сгенерируйте шаблон конфигурации с помощью:
```bash
/path/to/ccursor /path/to/settings.json
```

### Базовая конфигурация
| Параметр | Описание | Тип | Обязательно | По умолчанию | Поддерживаемая версия |
|----------|----------|-----|--------------|---------------|---------------------|
| `check-updates` | Проверка обновлений при запуске | bool | ❌ | false | 0.2.0+ |
| `github-token` | Токен доступа GitHub | string | ❌ | "" | 0.2.0+ |
| `usage-statistics` | Статистика использования модели | bool | ❌ | true | 0.2.1+ |
| `current-override` | Текущий активный идентификатор переопределения | string | ✅ | - | 0.2.0+ |

### Конфигурация сервиса (`service-config`)
| Параметр | Описание | Тип | Обязательно | По умолчанию | Поддерживаемая версия |
|----------|----------|-----|--------------|---------------|---------------------|
| `port` | Порт прослушивания сервиса | u16 | ✅ | - | Все версии |
| `lock-updates` | Блокировка обновлений | bool | ✅ | false | Все версии |
| `domain-suffix` | Суффикс домена | string | ✅ | - | Все версии |
| `proxy` | Конфигурация прокси-сервера | string | ❌ | "" | 0.2.0+ |
| `dns-resolver` | DNS резолвер (gai/hickory) | string | ❌ | "gai" | 0.2.0+ |
| `fake-email` | Конфигурация поддельной электронной почты | object | ❌ | {email="",sign-up-type="unknown",enable=false} | 0.2.0+ |
| `service-addr` | Конфигурация адреса сервиса | object | ❌ | {mode="local",suffix=".example.com",port=8080} | 0.2.0+ |

### Конфигурация переопределений (`overrides`)
| Параметр | Описание | Тип | Обязательно | По умолчанию | Поддерживаемая версия |
|----------|----------|-----|--------------|---------------|---------------------|
| `token` | JWT токен аутентификации | string | ❌ | - | Все версии |
| `traceparent` | Сохранение идентификатора трассировки | bool | ❌ | false | 0.2.0+ |
| `client-key` | Хеш ключа клиента | string | ❌ | - | 0.2.0+ |
| `checksum` | Комбинированная контрольная сумма | string | ❌ | - | 0.2.0+ |
| `client-version` | Номер версии клиента | string | ❌ | - | 0.2.0+ |
| `timezone` | Идентификатор часового пояса IANA | string | ❌ | - | Все версии |
| `ghost-mode` | Настройки режима приватности | bool | ❌ | true | 0.2.0+ |
| `session-id` | Уникальный идентификатор сессии | string | ❌ | - | 0.2.0+ |

**Особые примечания**:
- Параметры с пометкой "0.2.0+" отсутствовали в 0.1.x, но параметры с пометкой "Все версии" могут быть не полностью эквивалентны
- Параметры конфигурации со значениями по умолчанию можно закомментировать или удалить во избежание потенциальных проблем

## Внутренние интерфейсы
Интерфейсы в `/internal/` контролируются файлами в директории internal (возвращает index.html, когда файл не существует), за исключением следующих специальных интерфейсов:

### 1. TokenUpdate
**Функция**: Обновление параметра current-override во время выполнения
**Параметры**:
| Параметр | Обязательно | Описание |
|----------|-------------|----------|
| key | ✅ | Идентификатор конфигурации переопределения |

**Пример**:
```bash
curl http://127.0.0.1:3000/internal/TokenUpdate?key=${KEY_NAME}
```

### 2. TokenAdd
**Функция**: Получение URL авторизации и времени ожидания
**Возвращает**: `["url",100]`, где url - ссылка авторизации, а 100 - время ожидания в секундах

**Параметры**:
| Параметр | Обязательно | Описание |
|----------|-------------|----------|
| timezone | ✅ | Идентификатор часового пояса IANA (например, "Asia/Shanghai" или "America/Los_Angeles") |
| wait | ❌ | Время ожидания в секундах, по умолчанию 100 |
| client_version | ❌ | Номер версии клиента, по умолчанию 0.49.6 |

**Пример**:
```bash
# Базовое использование
curl http://127.0.0.1:3000/internal/TokenAdd?timezone=Asia%2FShanghai

# Пользовательское время ожидания
curl http://127.0.0.1:3000/internal/TokenAdd?timezone=Asia%2FShanghai&wait=50
```

### 3. ConfigUpdate
**Функция**: Запуск перезагрузки сервиса после обновления файла конфигурации

### 4. GetUsage
**Функция**: Получение статистики использования модели

---

*Отказ от ответственности включен в EULA. Проект может прекратить поддержку в любое время.*

Feel free!